# üîß –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (16 —è–Ω–≤–∞—Ä—è 2026)

## –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ 3 –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏

### ‚ùå –û—à–∏–±–∫–∞ 1: Failed to fetch dynamically imported module

**–ü—Ä–æ–±–ª–µ–º–∞:**
```
TypeError: Failed to fetch dynamically imported module: .../App.tsx
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í —Ñ–∞–π–ª–µ `/utils/supabase/client.tsx` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è –∏–º–ø–æ—Ä—Ç —Å –≤–µ—Ä—Å–∏–µ–π:
```typescript
import { createClient as createSupabaseClient } from '@supabase/supabase-js@2';
```

**–†–µ—à–µ–Ω–∏–µ:**
–£–¥–∞–ª–µ–Ω–∞ –≤–µ—Ä—Å–∏—è –∏–∑ –∏–º–ø–æ—Ä—Ç–∞ –¥–ª—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç—É Figma Make:
```typescript
import { createClient as createSupabaseClient } from '@supabase/supabase-js';
```

**–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:**
–†–∞—Å—à–∏—Ä–µ–Ω –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å `User` –≤ `/types/index.ts` —Å –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–º–∏ –ø–æ–ª—è–º–∏ –¥–ª—è –∞—Ä—Ç–∏—Å—Ç–æ–≤:
```typescript
export interface User {
  // ... existing fields
  stageName?: string;
  genres?: string[];
  experience?: string;
}
```

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `/utils/supabase/client.tsx` - –∏—Å–ø—Ä–∞–≤–ª–µ–Ω –∏–º–ø–æ—Ä—Ç
- `/types/index.ts` - –¥–æ–±–∞–≤–ª–µ–Ω—ã –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è

---

### ‚ùå –û—à–∏–±–∫–∞ 2: Could not find relationship between 'bookings' and 'artists_catalog'

**–ü—Ä–æ–±–ª–µ–º–∞:**
```json
{
  "code": "PGRST200",
  "message": "Could not find a relationship between 'bookings' and 'artists_catalog' in the schema cache"
}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
–í —Ö—É–∫–µ `useBookingsWithArtists.ts` –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª—Å—è JOIN —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å Supabase:
```typescript
.select(`
  *,
  artist:artists_catalog!artist_id (...)
`)
```

Supabase –Ω–µ –º–æ–≥ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å —Å–≤—è–∑—å, –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π foreign key.

**–†–µ—à–µ–Ω–∏–µ:**
–ò–∑–º–µ–Ω–µ–Ω –ø–æ–¥—Ö–æ–¥ - –≤–º–µ—Å—Ç–æ JOIN –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞ —Å –ø–æ—Å–ª–µ–¥—É—é—â–∏–º –æ–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ–º –¥–∞–Ω–Ω—ã—Ö –≤ –∫–æ–¥–µ:

```typescript
// 1. –ü–æ–ª—É—á–∞–µ–º –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è
const { data: bookingsData } = await supabase
  .from('bookings')
  .select('*')
  .eq('customer_id', userId);

// 2. –ü–æ–ª—É—á–∞–µ–º –∞—Ä—Ç–∏—Å—Ç–æ–≤ –æ–¥–Ω–∏–º –∑–∞–ø—Ä–æ—Å–æ–º
const artistIds = [...new Set(bookingsData.map(b => b.artist_id))];
const { data: artistsData } = await supabase
  .from('artists_catalog')
  .select('id, stage_name, avatar, rating, city, genres')
  .in('id', artistIds);

// 3. –û–±—ä–µ–¥–∏–Ω—è–µ–º –¥–∞–Ω–Ω—ã–µ
const artistsMap = new Map(artistsData.map(a => [a.id, a]));
const mappedBookings = bookingsData.map(booking => ({
  ...booking,
  artist: artistsMap.get(booking.artist_id)
}));
```

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- ‚úÖ –ù–µ –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∫—ç—à–∞ —Å—Ö–µ–º—ã Supabase
- ‚úÖ –ë–æ–ª–µ–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ (–æ–¥–∏–Ω –∑–∞–ø—Ä–æ—Å –≤–º–µ—Å—Ç–æ N+1)
- ‚úÖ –£—Å—Ç–æ–π—á–∏–≤–æ –∫ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏–º –¥–∞–Ω–Ω—ã–º
- ‚úÖ –õ–µ–≥—á–µ –æ—Ç–ª–∞–∂–∏–≤–∞—Ç—å

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `/hooks/useBookingsWithArtists.ts` - –∏–∑–º–µ–Ω–µ–Ω –º–µ—Ç–æ–¥ `fetchBookings()`

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `/BOOKING_FOREIGN_KEY_FIX.md` - –ø–æ–¥—Ä–æ–±–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

---

### ‚ùå –û—à–∏–±–∫–∞ 3: Infinite recursion detected in policy for relation "bookings"

**–ü—Ä–æ–±–ª–µ–º–∞:**
```json
{
  "code": "42P17",
  "message": "infinite recursion detected in policy for relation \"bookings\""
}
```

**–ü—Ä–∏—á–∏–Ω–∞:**
Row Level Security (RLS) –ø–æ–ª–∏—Ç–∏–∫–∞ –¥–ª—è —Ç–∞–±–ª–∏—Ü—ã `bookings` —Å–æ–¥–µ—Ä–∂–∞–ª–∞ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ —Ç–æ–π –∂–µ —Ç–∞–±–ª–∏—Ü–µ:

```sql
-- ‚ùå –†–µ–∫—É—Ä—Å–∏–≤–Ω—ã–π –∑–∞–ø—Ä–æ—Å
CREATE POLICY "Users can view their own bookings"
  ON public.bookings FOR SELECT
  USING (auth.uid() = customer_id OR auth.uid() IN (
    SELECT user_id FROM public.artist_profiles WHERE id IN (
      SELECT artist_id FROM public.bookings WHERE id = bookings.id
      --     ^^^^^^^^ –ü–†–û–ë–õ–ï–ú–ê: –∑–∞–ø—Ä–æ—Å –∫ bookings –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª–∏—Ç–∏–∫–∏ –¥–ª—è bookings
    )
  ));
```

–≠—Ç–æ —Å–æ–∑–¥–∞–≤–∞–ª–æ –±–µ—Å–∫–æ–Ω–µ—á–Ω—É—é —Ü–µ–ø–æ—á–∫—É: –ø–æ–ª–∏—Ç–∏–∫–∞ ‚Üí –∑–∞–ø—Ä–æ—Å ‚Üí –ø–æ–ª–∏—Ç–∏–∫–∞ ‚Üí –∑–∞–ø—Ä–æ—Å ‚Üí ...

**–†–µ—à–µ–Ω–∏–µ:**
–£–ø—Ä–æ—â–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –ø–æ–ª–∏—Ç–∏–∫ - —É–±—Ä–∞–Ω—ã —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã:

```sql
-- ‚úÖ –ë–µ–∑ —Ä–µ–∫—É—Ä—Å–∏–∏
CREATE POLICY "Users can view their own bookings"
  ON public.bookings FOR SELECT
  USING (
    auth.uid() = customer_id 
    OR 
    EXISTS (
      SELECT 1 FROM public.artist_profiles 
      WHERE artist_profiles.user_id = auth.uid()
    )
  );
```

**–õ–æ–≥–∏–∫–∞:**
- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–∏–¥–∏—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –µ—Å–ª–∏ –æ–Ω –∑–∞–∫–∞–∑—á–∏–∫
- –ò–õ–ò –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —è–≤–ª—è–µ—Ç—Å—è –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –∞—Ä—Ç–∏—Å—Ç–æ–º

**–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:**
- `/supabase/migrations/003_fix_rls_policies.sql` - –Ω–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è —Å –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º
- `/supabase/migrations/000_COMPLETE_SETUP.sql` - –æ–±–Ω–æ–≤–ª–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–∏

**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:**
- `/RLS_INFINITE_RECURSION_FIX.md` - –¥–µ—Ç–∞–ª—å–Ω–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º—ã –∏ —Ä–µ—à–µ–Ω–∏—è

---

## –°—Ç–∞—Ç—É—Å

‚úÖ **–í—Å–µ —Ç—Ä–∏ –æ—à–∏–±–∫–∏ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω—ã –∏ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã**

–ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ç–µ–ø–µ—Ä—å:
- –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∑–∞ÔøΩÔøΩ—Ä—É–∂–∞–µ—Ç—Å—è –±–µ–∑ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞
- –£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–∞–µ—Ç –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∞—Ä—Ç–∏—Å—Ç–æ–≤
- –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–ª—É—á–∞–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –¥–∞–Ω–Ω—ã—Ö

---

## –ë—ã—Å—Ç—Ä–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞

### –¢–µ—Å—Ç 1: –ó–∞–≥—Ä—É–∑–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
```bash
1. –û—Ç–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∫–æ–Ω—Å–æ–ª—å - –Ω–µ—Ç –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞ ‚úÖ
```

### –¢–µ—Å—Ç 2: –ó–∞–≥—Ä—É–∑–∫–∞ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–π
```bash
1. –í–æ–π—Ç–∏ –ø–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º —Å –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è–º–∏
2. –ü–µ—Ä–µ–π—Ç–∏ –≤ —Ä–∞–∑–¥–µ–ª "–ú–æ–∏ –±—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è"
3. –ë—Ä–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —Å –¥–∞–Ω–Ω—ã–º–∏ –∞—Ä—Ç–∏—Å—Ç–æ–≤ ‚úÖ
```

---

## –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

### Lessons Learned

1. **–ò–º–ø–æ—Ä—Ç—ã –≤ Figma Make:**
   - –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ –ø–∞–∫–µ—Ç–æ–≤ –∏–º–ø–æ—Ä—Ç–∏—Ä—É—é—Ç—Å—è –ë–ï–ó –≤–µ—Ä—Å–∏–∏
   - –ò—Å–∫–ª—é—á–µ–Ω–∏—è —É–∫–∞–∑–∞–Ω—ã –≤ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `react-hook-form@7.55.0`)

2. **Supabase JOIN:**
   - –°–∏–Ω—Ç–∞–∫—Å–∏—Å `!column_name` –Ω–µ –≤—Å–µ–≥–¥–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞–¥–µ–∂–Ω–æ
   - –î–ª—è production –ª—É—á—à–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `.in()` –¥–ª—è –±–∞—Ç—á-–∑–∞–≥—Ä—É–∑–∫–∏ —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

3. **TypeScript –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã:**
   - –í—Å–µ–≥–¥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ, —á—Ç–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã –≤–∫–ª—é—á–∞—é—Ç –≤—Å–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è
   - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è role-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

4. **Row Level Security (RLS) –ø–æ–ª–∏—Ç–∏–∫–∏:**
   - –ò–∑–±–µ–≥–∞–π—Ç–µ —Ä–µ–∫—É—Ä—Å–∏–≤–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –≤–Ω—É—Ç—Ä–∏ –ø–æ–ª–∏—Ç–∏–∫
   - –£–ø—Ä–æ—â–∞–π—Ç–µ –ª–æ–≥–∏–∫—É –ø–æ–ª–∏—Ç–∏–∫ –¥–ª—è –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏—è –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã—Ö —Ü–∏–∫–ª–æ–≤

---

**–î–∞—Ç–∞:** 16 —è–Ω–≤–∞—Ä—è 2026  
**–í—Ä–µ–º—è:** ~15 –º–∏–Ω—É—Ç –Ω–∞ –æ–±–∞ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è  
**–§–∞–π–ª–æ–≤ –∏–∑–º–µ–Ω–µ–Ω–æ:** 4  
**–°—Ç—Ä–æ–∫ –∫–æ–¥–∞:** ~100  
**–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏:** 1 –Ω–æ–≤—ã–π —Ñ–∞–π–ª

–°–º. —Ç–∞–∫–∂–µ:
- [FIXES_SUMMARY.md](./FIXES_SUMMARY.md) - –ø–æ–ª–Ω—ã–π —Å–ø–∏—Å–æ–∫ –≤—Å–µ—Ö –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–π
- [BOOKING_FOREIGN_KEY_FIX.md](./BOOKING_FOREIGN_KEY_FIX.md) - –¥–µ—Ç–∞–ª–∏ –ø–æ JOIN –æ—à–∏–±–∫–µ
- [RLS_INFINITE_RECURSION_FIX.md](./RLS_INFINITE_RECURSION_FIX.md) - –¥–µ—Ç–∞–ª–∏ –ø–æ RLS –æ—à–∏–±–∫–µ